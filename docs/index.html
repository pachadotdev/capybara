<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>capybara documentation ‚Ä¢ capybara</title><link rel="stylesheet" href="menu.css"><link rel="stylesheet" href="content.css"><!-- MathJax Configuration --><script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(', '\\)'], ['$', '$']],
        displayMath: [['\\[', '\\]'], ['$$', '$$']],
        processEscapes: true,
        processEnvironments: true,
        packages: {'[+]': ['ams', 'newcommand', 'configmacros']}
      },
      options: {
        ignoreHtmlClass: 'tex2jax_ignore',
        processHtmlClass: 'tex2jax_process'
      }
    };
  </script><script id="MathJax-script" async src="js/tex-svg.js"></script></head><body>
<div class="main-container">
<div id="menu">
  <div>
    <img src="man/figures/logo.svg" align="center" height="139" alt="capybara logo"></div>

  <div class="search-container">
    <input type="text" id="search-box" placeholder="Search..."></div>

  <div class="search-container">
    <button id="theme-toggle" title="Toggle dark mode" aria-label="Toggle dark mode">Toggle theme</button>
    <button id="font-decrease" title="Decrease font size" aria-label="Decrease font size">A-</button>
    <button id="font-increase" title="Increase font size" aria-label="Increase font size">A+</button>
  </div>

  <div class="submenu">
    <label style="border-bottom: 0;"><a style="padding-left: 0;" href="index.html">Home üè†</a></label>
  </div>

  <div class="submenu">
    <label>Functions</label>
    <a href="reference/apes.html">apes</a>
    <a href="reference/bias_corr.html">bias_corr</a>
    <a href="reference/feglm.html">feglm</a>
    <a href="reference/felm.html">felm</a>
    <a href="reference/fenegbin.html">fenegbin</a>
    <a href="reference/fepoisson.html">fepoisson</a>
    <a href="reference/fit_control.html">fit_control</a>
    <a href="reference/summary_table.html">summary_table</a>
  </div>

  <div class="submenu">
    <label>Vignettes</label>
    <a href="vignettes/intro.html">Poisson Pseudo-Maximum Likelihood (PPML) Model with Cluster-Robust Standard Errors</a>
    <a href="vignettes/separation.html">Nonexistence of estimates of Poisson models</a>
  </div>

  <div class="submenu">
    <label>News</label>
    <a href="news/index.html">Changelog</a>
  </div>
</div>
<div id="content">
<div class="content-wrapper">
        <div class="content-main">



<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="capybara" class="section level1">
<h1>capybara <img src="/home/pacha/Documents/capybara/man/figures/logo.svg" align="right" height="139" alt=""></h1>
<!-- badges: start -->
<p><a href="https://github.com/pachadotdev/capybara/actions/workflows/R-CMD-check.yaml"><img src="https://github.com/pachadotdev/capybara/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a>
<a href="https://app.codecov.io/gh/pachadotdev/capybara"><img src="https://app.codecov.io/gh/pachadotdev/capybara/graph/badge.svg?token=kDP0pWmfRk" alt="codecov"></a>
<a href="https://buymeacoffee.com/pacha"><img src="https://raw.githubusercontent.com/pachadotdev/buymeacoffee-badges/main/bmc-donate-yellow.svg" alt="BuyMeACoffee"></a>
<a href="https://lifecycle.r-lib.org/articles/stages.html#stable"><img src="https://img.shields.io/badge/lifecycle-stable-brightgreen.svg" alt="Lifecycle: stable"></a>
<a href="https://CRAN.R-project.org/package=capybara"><img src="https://www.r-pkg.org/badges/version/capybara" alt="CRAN status"></a>
<!-- badges: end --></p>
<div id="about" class="section level2">
<h2>About</h2>
<p>Please read my article for the full details of this project (Open
Access):</p>
<blockquote>
<p>Vargas Sepulveda, Mauricio. 2025. ‚ÄòCapybara: Efficient Estimation of
Generalized Linear Models with High-Dimensional Fixed Effects‚Äô. <em>PLOS
ONE</em> 20 (9): e0331178. <a href="https://doi.org/10.1371/journal.pone.0331178" class="uri">https://doi.org/10.1371/journal.pone.0331178</a>.</p>
</blockquote>
<p>If you have a 2-4GB dataset and you need to estimate a (generalized)
linear model with a large number of fixed effects, this package is for
you. It works with larger datasets as well and facilites computing
clustered standard errors.</p>
<p>‚Äòcapybara‚Äô is a fast and small footprint software that provides
efficient functions for demeaning variables before conducting a GLM
estimation. This technique is particularly useful when estimating linear
models with multiple group fixed effects. It is a fork of the excellent
Alpaca package created and maintained by <a href="https://github.com/amrei-stammann">Dr.¬†Amrei
Stammann</a>. The software can estimate
Exponential Family models (e.g., Poisson) and Negative Binomial models.</p>
<p>Traditional QR estimation can be unfeasible due to additional memory
requirements. The method, which is based on Halperin (1962) vector
projections offers important time and memory savings without
compromising numerical stability in the estimation process.</p>
<p>The software heavily borrows from Gaure (2013) and Stammann (2018) works
on OLS and GLM estimation with large fixed effects implemented in the
‚Äòlfe‚Äô and ‚Äòalpaca‚Äô packages. The differences are that ‚Äòcapybara‚Äô does
not use C nor Rcpp code, instead it uses cpp11 and
<a href="https://github.com/pachadotdev/cpp11armadillo">cpp11armadillo</a>.</p>
<p>The summary tables borrow from Stata outputs. I have also provided
integrations with ‚Äòbroom‚Äô to facilitate the inclusion of statistical
tables in Quarto/Jupyter notebooks.</p>
<p>If this software is useful to you, please consider donating on <a href="https://buymeacoffee.com/pacha">Buy Me A
Coffee</a>. All donations will be used to
continue improving <code>capybara</code>.</p>
</div>
<div id="installation" class="section level2">
<h2>Installation</h2>
<p>You can install the development version of capybara like so:</p>
<pre class="r"><code>remotes::install_github("pachadotdev/capybara")</code></pre>
</div>
<div id="examples" class="section level2">
<h2>Examples</h2>
<p>See the documentation: <a href="https://pacha.dev/capybara/" class="uri">https://pacha.dev/capybara/</a>.</p>
<p>Here is simple example of estimating a linear model and a Poisson model
with fixed effects:</p>
<pre class="r"><code>m1 &lt;- felm(mpg ~ wt | cyl, mtcars)
m2 &lt;- fepoisson(mpg ~ wt | cyl, mtcars)
summary_table(m1, m2, model_names = c("Linear", "Poisson"))

|     Variable     |       Linear        |      Poisson      |
|------------------|---------------------|-------------------|
| wt               |           -3.206*** |           -0.180* |
|                  |             (0.295) |           (0.072) |
|                  |                     |                   |
| Fixed effects    |                     |                   |
| cyl              |                 Yes |               Yes |
|                  |                     |                   |
| N                |                  32 |                32 |
| R-squared        |               0.837 |             0.616 |

Standard errors in parenthesis
Significance levels: *** p &lt; 0.001; ** p &lt; 0.01; * p &lt; 0.05; . p &lt; 0.1</code></pre>
</div>
<div id="design-choices" class="section level2">
<h2>Design choices</h2>
<p>Capybara is full of trade-offs. I have used ‚Äòdata.table‚Äô to benefit from
in-place modifications. The model fitting is done on C++ side. While the
code aims to be fast, I prefer to have some bottlenecks instead of low
numerical stability or reinvent the wheel. Armadillo works great for the
size of data and the models that I use for my research. The principle
was: ‚ÄúHe who gives up code safety for code speed deserves neither.‚Äù
(Wickham, 2014).</p>
</div>
<div id="benchmarks" class="section level2">
<h2>Benchmarks</h2>
<p>Median time and memory footprint for the different models in the book
<a href="https://www.wto.org/english/res_e/publications_e/advancedguide2016_e.htm">An Advanced Guide to Trade Policy
Analysis</a>.</p>
<table><thead><tr class="header"><th align="left">Model</th>
<th align="left">Package</th>
<th align="left">Median Time</th>
<th align="left">Memory</th>
</tr></thead><tbody><tr class="odd"><td align="left">PPML</td>
<td align="left">Alpaca</td>
<td align="left">720.07 ms - 3</td>
<td align="left">302.64 MB - 3</td>
</tr><tr class="even"><td align="left">PPML</td>
<td align="left">Base R</td>
<td align="left">41.72 s - 4</td>
<td align="left">2.73 GB - 4</td>
</tr><tr class="odd"><td align="left">PPML</td>
<td align="left">Capybara</td>
<td align="left">405.89 ms - 2</td>
<td align="left">19.22 MB - 1</td>
</tr><tr class="even"><td align="left">PPML</td>
<td align="left">Fixest</td>
<td align="left">130.1 ms - 1</td>
<td align="left">44.59 MB - 2</td>
</tr><tr class="odd"><td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr><tr class="even"><td align="left">Trade Diversion</td>
<td align="left">Alpaca</td>
<td align="left">3.79 s - 3</td>
<td align="left">339.79 MB - 3</td>
</tr><tr class="odd"><td align="left">Trade Diversion</td>
<td align="left">Base R</td>
<td align="left">39.84 s - 4</td>
<td align="left">2.6 GB - 4</td>
</tr><tr class="even"><td align="left">Trade Diversion</td>
<td align="left">Capybara</td>
<td align="left">947.96 ms - 2</td>
<td align="left">26.22 MB - 1</td>
</tr><tr class="odd"><td align="left">Trade Diversion</td>
<td align="left">Fixest</td>
<td align="left">932.78 ms - 1</td>
<td align="left">36.59 MB - 2</td>
</tr><tr class="even"><td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr><tr class="odd"><td align="left">Endogeneity</td>
<td align="left">Alpaca</td>
<td align="left">2.65 s - 3</td>
<td align="left">306.27 MB - 3</td>
</tr><tr class="even"><td align="left">Endogeneity</td>
<td align="left">Base R</td>
<td align="left">10.7 m - 4</td>
<td align="left">11.94 GB - 4</td>
</tr><tr class="odd"><td align="left">Endogeneity</td>
<td align="left">Capybara</td>
<td align="left">1.32 s - 2</td>
<td align="left">15.55 MB - 1</td>
</tr><tr class="even"><td align="left">Endogeneity</td>
<td align="left">Fixest</td>
<td align="left">225.64 ms - 1</td>
<td align="left">28.08 MB - 2</td>
</tr><tr class="odd"><td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr><tr class="even"><td align="left">Reverse Causality</td>
<td align="left">Alpaca</td>
<td align="left">3.36 s - 3</td>
<td align="left">335.61 MB - 3</td>
</tr><tr class="odd"><td align="left">Reverse Causality</td>
<td align="left">Base R</td>
<td align="left">10.69 m - 4</td>
<td align="left">11.94 GB - 4</td>
</tr><tr class="even"><td align="left">Reverse Causality</td>
<td align="left">Capybara</td>
<td align="left">1.36 s - 2</td>
<td align="left">17.73 MB - 1</td>
</tr><tr class="odd"><td align="left">Reverse Causality</td>
<td align="left">Fixest</td>
<td align="left">296.63 ms - 1</td>
<td align="left">32.43 MB - 2</td>
</tr><tr class="even"><td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr><tr class="odd"><td align="left">Phasing Effects</td>
<td align="left">Alpaca</td>
<td align="left">4.6 s - 3</td>
<td align="left">393.86 MB - 3</td>
</tr><tr class="even"><td align="left">Phasing Effects</td>
<td align="left">Base R</td>
<td align="left">10.75 m - 4</td>
<td align="left">11.95 GB - 4</td>
</tr><tr class="odd"><td align="left">Phasing Effects</td>
<td align="left">Capybara</td>
<td align="left">1.57 s - 2</td>
<td align="left">22.08 MB - 1</td>
</tr><tr class="even"><td align="left">Phasing Effects</td>
<td align="left">Fixest</td>
<td align="left">471.1 ms - 1</td>
<td align="left">41.12 MB - 2</td>
</tr><tr class="odd"><td align="left"></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr><tr class="even"><td align="left">Globalization</td>
<td align="left">Alpaca</td>
<td align="left">8.2 s - 3</td>
<td align="left">539.49 MB - 3</td>
</tr><tr class="odd"><td align="left">Globalization</td>
<td align="left">Base R</td>
<td align="left">10.79 m - 4</td>
<td align="left">11.97 GB - 4</td>
</tr><tr class="even"><td align="left">Globalization</td>
<td align="left">Capybara</td>
<td align="left">2.07 s - 2</td>
<td align="left">32.98 MB - 1</td>
</tr><tr class="odd"><td align="left">Globalization</td>
<td align="left">Fixest</td>
<td align="left">869.62 ms - 1</td>
<td align="left">62.87 MB - 2</td>
</tr></tbody></table></div>
<div id="changing-the-number-of-cores" class="section level2">
<h2>Changing the number of cores</h2>
<p>Note that you can use <code>Sys.setenv(CAPYBARA_NCORES = 4)</code> (or other
positive integers) to change the number of cores that capybara uses,
here is an example of how it affects the performance</p>
<table><thead><tr class="header"><th align="left">cores</th>
<th align="right">PPML</th>
<th align="right">Trade Diversion</th>
</tr></thead><tbody><tr class="odd"><td align="left">2</td>
<td align="right">1.8s</td>
<td align="right">16.2s</td>
</tr><tr class="even"><td align="left">4</td>
<td align="right">1.5s</td>
<td align="right">14.0s</td>
</tr><tr class="odd"><td align="left">6</td>
<td align="right">0.8s</td>
<td align="right">2.4s</td>
</tr><tr class="even"><td align="left">8</td>
<td align="right">0.4s</td>
<td align="right">0.9s</td>
</tr></tbody></table></div>
<div id="installing-with-compiler-optimizations" class="section level2">
<h2>Installing with compiler optimizations</h2>
<p>CRAN packages are built with the <code>-O2</code> compiler flag, which is
sufficient for most packages, including capybara. However, if you want
to use the maximum compiler optimizations, you can do so by setting the
<code>-O3</code> compiler flag.</p>
<p>To do that, create a user Makevars file in your home directory
(<code>~/.R/Makevars</code>) and add the following lines:</p>
<pre class="makefile"><code># Copy to ~/.R/Makevars if you want to override R's default optimization
CXXFLAGS = -O3
CXX11FLAGS = -O3
CXX14FLAGS = -O3
CXX17FLAGS = -O3
CXX20FLAGS = -O3</code></pre>
<p>Additional optimizations can be enabled by setting the
<code>CAPYBARA_PORTABLE</code> environment variable to <code>"no"</code> before installing the
package. This will enable hardware-specific compiler flags that can
significantly improve performance (sometimes 2-4x faster than just using
portable flags).</p>
<pre class="r"><code>Sys.setenv(CAPYBARA_OPTIMIZATIONS = "yes")

# CRAN version
install.packages("capybara", type = "source")

# Local version
install.packages(".", repos = NULL, type = "source")
# or
devtools::install()</code></pre>
<p>This will determine if your hardware allows hardware-specific compiler
flags that provide significant performance improvements (sometimes 2-4x
faster than just using portable flags).</p>
</div>
<div id="code-of-conduct" class="section level2">
<h2>Code of Conduct</h2>
<p>Please note that the capybara project is released with a <a href="https://contributor-covenant.org/version/2/1/CODE_OF_CONDUCT.html">Contributor
Code of
Conduct</a>.
By contributing to this project, you agree to abide by its terms.</p>
</div>
<div id="acknowledgements" class="section level2">
<h2>Acknowledgements</h2>
<p>Thanks a lot to <a href="https://yotoyotov.com/">Prof.¬†Yoto Yotov</a> for reviewing
the summary functions.</p>
</div>
</div>
        </div>
        <footer><p id="last-updated">Loading...</p>
</footer><script src="js/footer.js"></script><script src="js/theme.js"></script><script src="js/search.js"></script><script src="js/fontsize.js"></script></div>
</div>
</div>
</body></html>

