<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fast and Memory Efficient Fitting of Linear Models With High-Dimensional
    Fixed Effects • capybara</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Fast and Memory Efficient Fitting of Linear Models With High-Dimensional
    Fixed Effects">
<meta property="og:description" content="Fast and user-friendly estimation of generalized linear models with
    multiple fixed effects and cluster the standard errors. The method to obtain
    the estimated fixed-effects coefficients is based on Stammann (2018) 
    &lt;https://arxiv.org/abs/1707.01815&gt; and Gaure (2013)
    &lt;https://dx.doi.org/10.1016/j.csda.2013.03.024&gt;.">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">capybara</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/intro.html">Poisson Pseudo-Maximum Likelihood (PPML) Model with Cluster-Robust Standard Errors</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pachadotdev/capybara/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="capybara-">capybara <img src="reference/figures/logo.svg" align="right" height="139" alt=""><a class="anchor" aria-label="anchor" href="#capybara-"></a>
</h1></div>
<!-- badges: start -->
<div class="section level2">
<h2 id="about">About<a class="anchor" aria-label="anchor" href="#about"></a>
</h2>
<p>tldr; If you have a 2-4GB dataset and you need to estimate a (generalized) linear model with a large number of fixed effects, this package is for you. It works with larger datasets as well.</p>
<p>Capybara is a fast and small footprint software that provides efficient functions for demeaning variables before conducting a GLM estimation via Iteratively Weighted Least Squares (IWLS). This technique is particularly useful when estimating linear models with multiple group fixed effects. It is a fork of the excellent Alpaca package created and maintained by <a href="https://github.com/amrei-stammann" class="external-link">Dr. Amrei Stammann</a>.</p>
<p>The software can estimate GLMs from the Exponential Family and also Negative Binomial models but the focus will be the Poisson estimator because it is the one used for structural counterfactual analysis in International Trade. It is relevant to add that the IWLS estimator is equivalent with the PPML estimator from Santos-Silva et al. 2006</p>
<p>Traditional QR estimation can be unfeasible due to additional memory requirements. The method, which is based on Halperin 1962 article on vector projections offers important time and memory savings without compromising numerical stability in the estimation process.</p>
<p>The software heavily borrows from Gaure 20213 and Stammann 2018 works on the OLS and IWLS estimator with large k-way fixed effects (i.e., the lfe and alpaca packages). The differences are that Capybara does not use C nor Rcpp code, instead it uses the cpp11 and <a href="https://github.com/pachadotdev/cpp11armadillo" class="external-link">cpp11armadillo</a> packages.</p>
<p>The summary tables are nothing like R’s default and borrow from Stata outputs. I have also provided integrations with broom to facilitate the inclusion of statistical tables in Quarto/Jupyter notebooks.</p>
<p>If this software is useful to you, please consider donating on <a href="https://buymeacoffee.com/pacha" class="external-link">Buy Me A Coffee</a>. All donations will be used to continue improving <code>capybara</code>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the development version of capybara like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"pachadotdev/capybara"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>See the documentation in progress: <a href="https://pacha.dev/capybara" class="external-link uri">https://pacha.dev/capybara</a>.</p>
</div>
<div class="section level2">
<h2 id="design-choices">Design choices<a class="anchor" aria-label="anchor" href="#design-choices"></a>
</h2>
<p>Capybara uses C++ to address some bottlenecks. It also uses data.table because it allows me to use hash tables.</p>
<p>I tried to implement an important lesson between v0.1 and v0.2: “He who gives up [code] safety for [code] speed deserves neither.” (Wickham, 2014).</p>
<p>I know some parts of the code are not particularly easy to understand. For example, I initially wrote an implementation for Kendall’s Tau (or Kendall’s correlation) with a time complexity of O(n^2). Posterior work on it, allowed me to solve the bottleneck that computation created, and I was able to reduce it to a time complexity of O(n * log(n)) at the expense of making the code harder to understand, but I still did my best to write a straightforward code.</p>
<p>Capybara is full of trade-offs. I used dplyr and dtplyr to help myself with the data.table syntax, otherwise there is no way to use in-place modification of data. This is something intentional in dplyr to avoid side effects like changing the input data. In my research I use SQL because I have over 200 GB of international trade data, where dplyr helps a lot because it allows me to query SQL directly from R and just using dplyr syntax, something impossible with data.table, which requires me to go to the SQL editor en export my queries in CSV format and then import them in R.</p>
<p>With data.table you get faster computation and a slightly reduced use of memory. The problem is to understand the code when you are familiar with data.table. data.table uses in-place modification, which gives me the heebie-jeebies, but I am ok with it as I am using in internal package functions that the end user never sees. I think data.table and dplyr are great tools, the problem is the user that uses one in the same way as some people use a plier instead of a wrench.</p>
<p>I think with my design choices I accomplished my goal of making model estimation feasible, and now I can run models on my laptop relying on UofT’s servers a bit less.</p>
</div>
<div class="section level2">
<h2 id="future-plans">Future plans<a class="anchor" aria-label="anchor" href="#future-plans"></a>
</h2>
<p>I will also work on adding a RESET test to summaries as default and make clustered standard errors computation a bit easier.</p>
<p>This also needs lots of tests. There are a few in the dev folder, but I need to test with testthat.</p>
</div>
<div class="section level2">
<h2 id="benchmarks">Benchmarks<a class="anchor" aria-label="anchor" href="#benchmarks"></a>
</h2>
<p>Median time for the different models in the book <a href="https://www.wto.org/english/res_e/publications_e/advancedguide2016_e.htm" class="external-link">An Advanced Guide to Trade Policy Analysis</a>.</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="6%">
<col width="14%">
<col width="10%">
<col width="16%">
<col width="25%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">package</th>
<th align="right">PPML</th>
<th align="right">Trade Diversion</th>
<th align="right">Endogeneity</th>
<th align="right">Reverse Causality</th>
<th align="right">Non-linear/Phasing Effects</th>
<th align="right">Globalization</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alpaca</td>
<td align="right">213.4ms</td>
<td align="right">2.3s</td>
<td align="right">1.35s</td>
<td align="right">1.86s</td>
<td align="right">2.59s</td>
<td align="right">4.96s</td>
</tr>
<tr class="even">
<td align="left">Base R</td>
<td align="right">1.5m</td>
<td align="right">1.53m</td>
<td align="right">23.43m</td>
<td align="right">23.52m</td>
<td align="right">23.16m</td>
<td align="right">24.85m</td>
</tr>
<tr class="odd">
<td align="left"><strong>Capybara</strong></td>
<td align="right">371ms</td>
<td align="right">3s</td>
<td align="right">1.34s</td>
<td align="right">1.71s</td>
<td align="right">2.46s</td>
<td align="right">4.64s</td>
</tr>
<tr class="even">
<td align="left">Fixest</td>
<td align="right">67.4ms</td>
<td align="right">477.08ms</td>
<td align="right">95.88ms</td>
<td align="right">136.21ms</td>
<td align="right">206.12ms</td>
<td align="right">415.31ms</td>
</tr>
</tbody>
</table>
<p>Memory allocation for the same models</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="6%">
<col width="14%">
<col width="10%">
<col width="16%">
<col width="25%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">package</th>
<th align="right">PPML</th>
<th align="right">Trade Diversion</th>
<th align="right">Endogeneity</th>
<th align="right">Reverse Causality</th>
<th align="right">Non-linear/Phasing Effects</th>
<th align="right">Globalization</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Alpaca</td>
<td align="right">304.8MB</td>
<td align="right">339.8MB</td>
<td align="right">306.3MB</td>
<td align="right">335.61MB</td>
<td align="right">393.86MB</td>
<td align="right">539.49MB</td>
</tr>
<tr class="even">
<td align="left">Base R</td>
<td align="right">2.73GB</td>
<td align="right">2.6GB</td>
<td align="right">11.9GB</td>
<td align="right">11.94GB</td>
<td align="right">11.95GB</td>
<td align="right">11.97GB</td>
</tr>
<tr class="odd">
<td align="left"><strong>Capybara</strong></td>
<td align="right">307MB</td>
<td align="right">341MB</td>
<td align="right">306MB</td>
<td align="right">336MB</td>
<td align="right">395MB</td>
<td align="right">541MB</td>
</tr>
<tr class="even">
<td align="left">Fixest</td>
<td align="right">44.59MB</td>
<td align="right">36.59MB</td>
<td align="right">28.1MB</td>
<td align="right">32.43MB</td>
<td align="right">41.12MB</td>
<td align="right">62.87MB</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level1">
<h1 id="debugging">Debugging<a class="anchor" aria-label="anchor" href="#debugging"></a>
</h1>
<p><em>This debugging is about code quality, not about statistical quality.</em> <em>There is a full set of numerical tests for testthat to check the math.</em> <em>In this section of the test, I can write pi = 3 and if there are no memory leaks, it will pass the test.</em></p>
<p>I run <code>r_valgrind "dev/test_get_alpha.r"</code> or the corresponding test from the project’s root in a new terminal (bash).</p>
<p>This works because I previously defined this in <code>.bashrc</code>, to make it work you need to run <code>source ~/.bashrc</code> or reboot:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a><span class="cf">function</span> <span class="kw">r_debug_symbols</span> () {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>    <span class="co"># if src/Makevars does not exist, exit</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true"></a>    <span class="cf">if</span> [ <span class="op">!</span><span class="st"> </span><span class="op">-</span>f src<span class="op">/</span>Makevars ]; then</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true"></a>        echo <span class="st">"File src/Makevars does not exist"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true"></a>        return <span class="dv">1</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true"></a>    fi</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true"></a>    <span class="co"># if src/Makevars contains a line that says "PKG_CPPFLAGS"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true"></a>    <span class="co"># but there is no "-UDEBUG -g" on it</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true"></a>    <span class="co"># then add "PKG_CPPFLAGS += -UDEBUG -g" at the end</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true"></a>    <span class="cf">if</span> grep <span class="op">-</span>q <span class="st">"PKG_CPPFLAGS"</span> src<span class="op">/</span>Makevars; then</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true"></a>        <span class="cf">if</span> <span class="op">!</span><span class="st"> </span>grep <span class="op">-</span>q <span class="st">"PKG_CPPFLAGS.*-UDEBUG.*-g"</span> src<span class="op">/</span>Makevars; then</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true"></a>            echo <span class="st">"PKG_CPPFLAGS += -UDEBUG -g"</span> <span class="op">&gt;</span><span class="er">&gt;</span><span class="st"> </span>src<span class="op">/</span>Makevars</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true"></a>        fi</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true"></a>    fi</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true"></a>    <span class="co"># if src/Makevars does not contain a line that reads</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true"></a>    <span class="co"># PKG_CPPFLAGS ...something... -UDEBUG -g ...something...</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true"></a>    <span class="co"># then add PKG_CPPFLAGS = -UDEBUG -g to it</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true"></a>    <span class="cf">if</span> <span class="op">!</span><span class="st"> </span>grep <span class="op">-</span>q <span class="st">"PKG_CPPFLAGS.*-UDEBUG.*-g"</span> src<span class="op">/</span>Makevars; then</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true"></a>        echo <span class="st">"PKG_CPPFLAGS = -UDEBUG -g"</span> <span class="op">&gt;</span><span class="er">&gt;</span><span class="st"> </span>src<span class="op">/</span>Makevars</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true"></a>    fi</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true"></a>}</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true"></a><span class="cf">function</span> <span class="kw">r_valgrind</span> () {</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true"></a>    <span class="co"># if no argument is provided, ask for a file</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true"></a>    <span class="cf">if</span> [ <span class="op">-</span>z <span class="st">"$1"</span> ]; then</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true"></a>        read <span class="op">-</span>p <span class="st">"Enter the script to debug: "</span> script</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true"></a>    <span class="cf">else</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true"></a>        script=<span class="er">$</span><span class="dv">1</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true"></a>    fi</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true"></a>    <span class="co"># if no output file is provided, use the same filename but ended in txt</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true"></a>    <span class="cf">if</span> [ <span class="op">-</span>z <span class="st">"$2"</span> ]; then</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true"></a>        output=<span class="st">"${script%.*}.txt"</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true"></a>    <span class="cf">else</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true"></a>        output=<span class="er">$</span><span class="dv">2</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true"></a>    fi</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true"></a>    <span class="co"># if the file does not exist, exit</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true"></a>    <span class="cf">if</span> [ <span class="op">!</span><span class="st"> </span><span class="op">-</span>f <span class="st">"$script"</span> ]; then</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true"></a>        echo <span class="st">"File $script does not exist"</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true"></a>        return <span class="dv">1</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true"></a>    fi</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true"></a>    <span class="co"># if the file does not end in .R/.r, exit</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true"></a>    shopt <span class="op">-</span>s nocasematch</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true"></a>    <span class="cf">if</span> [[ <span class="st">"$script"</span> <span class="op">!=</span><span class="st"> </span><span class="er">*</span>.R ]]; then</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true"></a>        echo <span class="st">"File $script does not end in .R or .r"</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true"></a>        return <span class="dv">1</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true"></a>    fi</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true"></a>    shopt <span class="op">-</span>u nocasematch</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true"></a></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true"></a>    <span class="co"># run R in debug mode, but after that we compiled with debug symbols</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true"></a>    <span class="co"># see https://reside-ic.github.io/blog/debugging-memory-errors-with-valgrind-and-gdb/</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true"></a>    <span class="co"># R -d 'valgrind -s --leak-check=full --show-leak-kinds=all --track-origins=yes' -f $script 2&gt;&amp;1 | tee valgrind.txt</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true"></a>    R <span class="op">--</span>vanilla <span class="op">-</span>d <span class="st">'valgrind -s --track-origins=yes'</span> <span class="op">-</span>f <span class="op">$</span>script <span class="dv">2</span><span class="op">&gt;</span><span class="er">&amp;</span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>tee <span class="op">$</span>output</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true"></a>}</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true"></a></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true"></a><span class="co"># create an alias for R</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true"></a>alias r=<span class="st">"R"</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true"></a>alias rvalgrind=<span class="st">"R --vanilla -d 'valgrind -s --track-origins=yes'"</span></span></code></pre></div>
<p><code>r_debug_symbols()</code> makes everything slower, but makes sure that all compiler optimizations are disabled and then valgrind will point us to the lines that create memory leaks.</p>
<p><code>r_valgrind()</code> will run an R script and use Linux system tools to test for initialized values and all kinds of problems that result in memory leaks.</p>
<p>When you are ready testing, you need to remove <code>-UDEGUG</code> from <code>src/Makevars</code>.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/pachadotdev/capybara/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/pachadotdev/capybara/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>Apache License (&gt;= 2)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing capybara</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Mauricio Vargas Sepulveda <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1017-7574" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/pachadotdev/capybara/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/pachadotdev/capybara/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://codecov.io/gh/pachadotdev/capybara" class="external-link"><img src="https://codecov.io/gh/pachadotdev/capybara/graph/badge.svg?token=kDP0pWmfRk" alt="codecov"></a></li>
<li><a href="https://www.buymeacoffee.com/pacha" class="external-link"><img src="reference/figures/bmc-donate.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Mauricio Vargas Sepulveda.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
