<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute average partial effects after fitting binary choice models with a 1,2,3-way error component — apes • capybara</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute average partial effects after fitting binary choice models with a 1,2,3-way error component — apes"><meta name="description" content="apes is a post-estimation routine that can be used
to estimate average partial effects with respect to all covariates in the
model and the corresponding covariance matrix. The estimation of the
covariance is based on a linear approximation (delta method) plus an
optional finite population correction. Note that the command automatically
determines which of the regressors are binary or non-binary.
Remark: The routine currently does not allow to compute average
partial effects based on functional forms like interactions and polynomials."><meta property="og:description" content="apes is a post-estimation routine that can be used
to estimate average partial effects with respect to all covariates in the
model and the corresponding covariance matrix. The estimation of the
covariance is based on a linear approximation (delta method) plus an
optional finite population correction. Note that the command automatically
determines which of the regressors are binary or non-binary.
Remark: The routine currently does not allow to compute average
partial effects based on functional forms like interactions and polynomials."><meta property="og:image" content="../capybara/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">capybara</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/intro.html">Poisson Pseudo-Maximum Likelihood (PPML) Model with Cluster-Robust Standard Errors</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/pachadotdev/capybara/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Compute average partial effects after fitting binary choice models with a 1,2,3-way error component</h1>
      <small class="dont-index">Source: <a href="https://github.com/pachadotdev/capybara/blob/HEAD/R/apes.R"><code>R/apes.R</code></a></small>
      <div class="d-none name"><code>apes.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>apes</code> is a post-estimation routine that can be used
to estimate average partial effects with respect to all covariates in the
model and the corresponding covariance matrix. The estimation of the
covariance is based on a linear approximation (delta method) plus an
optional finite population correction. Note that the command automatically
determines which of the regressors are binary or non-binary.</p>
<p><strong>Remark:</strong> The routine currently does not allow to compute average
partial effects based on functional forms like interactions and polynomials.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">apes</span><span class="op">(</span></span>
<span>  object <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_pop <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  panel_structure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classic"</span>, <span class="st">"network"</span><span class="op">)</span>,</span>
<span>  sampling_fe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"independence"</span>, <span class="st">"unrestricted"</span><span class="op">)</span>,</span>
<span>  weak_exo <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>an object of class <code>"bias_corr"</code> or <code>"feglm"</code>;
currently restricted to <code><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></code>.</p></dd>


<dt id="arg-n-pop">n_pop<a class="anchor" aria-label="anchor" href="#arg-n-pop"></a></dt>
<dd><p>unsigned integer indicating a finite population correction for
the estimation of the covariance matrix of the average partial effects
proposed by Cruz-Gonzalez, Fernández-Val, and Weidner (2017). The correction
factor is computed as follows:
\((n^{\ast} - n) / (n^{\ast} - 1)\),
where \(n^{\ast}\) and \(n\) are the sizes of the entire
population and the full sample size. Default is <code>NULL</code>, which refers to
a factor of zero and a covariance obtained by the delta method.</p></dd>


<dt id="arg-panel-structure">panel_structure<a class="anchor" aria-label="anchor" href="#arg-panel-structure"></a></dt>
<dd><p>a string equal to <code>"classic"</code> or <code>"network"</code>
which determines the structure of the panel used. <code>"classic"</code> denotes
panel structures where for example the same cross-sectional units are
observed several times (this includes pseudo panels). <code>"network"</code>
denotes panel structures where for example bilateral trade flows are
observed for several time periods. Default is <code>"classic"</code>.</p></dd>


<dt id="arg-sampling-fe">sampling_fe<a class="anchor" aria-label="anchor" href="#arg-sampling-fe"></a></dt>
<dd><p>a string equal to <code>"independence"</code> or
<code>"unrestricted"</code> which imposes sampling assumptions about the
unobserved effects. <code>"independence"</code> imposes that all unobserved
effects are independent sequences. <code>"unrestricted"</code> does not impose any
sampling assumptions. Note that this option only affects the optional finite
population correction. Default is <code>"independence"</code>.</p></dd>


<dt id="arg-weak-exo">weak_exo<a class="anchor" aria-label="anchor" href="#arg-weak-exo"></a></dt>
<dd><p>logical indicating if some of the regressors are assumed to
be weakly exogenous (e.g. predetermined). If object is of class
<code>"bias_corr"</code>, the option will be automatically set to <code>TRUE</code> if
the chosen bandwidth parameter is larger than zero. Note that this option
only affects the estimation of the covariance matrix. Default is
<code>FALSE</code>, which assumes that all regressors are strictly exogenous.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function <code>apes</code> returns a named list of class
<code>"apes"</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Cruz-Gonzalez, M., I. Fernández-Val, and M. Weidner (2017). "Bias
corrections for probit and logit models with two-way fixed effects". The
Stata Journal, 17(3), 517-545.</p>
<p>Czarnowske, D. and A. Stammann (2020). "Fixed Effects Binary
Choice Models: Estimation and Inference with Long Panels". ArXiv e-prints.</p>
<p>Fernández-Val, I. and M. Weidner (2016). "Individual and time
effects in nonlinear panel models with large N, T". Journal of Econometrics,
192(1), 291-312.</p>
<p>Fernández-Val, I. and M. Weidner (2018). "Fixed effects
estimation of large-t panel data models". Annual Review of Economics, 10,
109-138.</p>
<p>Hinz, J., A. Stammann, and J. Wanner (2020). "State Dependence
and Unobserved Heterogeneity in the Extensive Margin of Trade". ArXiv
e-prints.</p>
<p>Neyman, J. and E. L. Scott (1948). "Consistent estimates based on
partially consistent observations". Econometrica, 16(1), 1-32.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="bias_corr.html">bias_corr</a></code>, <code><a href="feglm.html">feglm</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># subset trade flows to avoid fitting time warnings during check</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">trade_2006</span> <span class="op">&lt;-</span> <span class="va">trade_panel</span><span class="op">[</span><span class="va">trade_panel</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2006</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">trade_2006</span> <span class="op">&lt;-</span> <span class="va">trade_2006</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trade_2006</span><span class="op">)</span>, <span class="fl">500</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">trade_2006</span><span class="op">$</span><span class="va">trade</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">trade_2006</span><span class="op">$</span><span class="va">trade</span> <span class="op">&gt;</span> <span class="fl">100</span>, <span class="fl">1L</span>, <span class="fl">0L</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Fit 'feglm()'</span></span></span>
<span class="r-in"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="feglm.html">feglm</a></span><span class="op">(</span><span class="va">trade</span> <span class="op">~</span> <span class="va">lang</span> <span class="op">|</span> <span class="va">year</span>, <span class="va">trade_2006</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute average partial effects</span></span></span>
<span class="r-in"><span><span class="va">mod_ape</span> <span class="op">&lt;-</span> <span class="fu">apes</span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_ape</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lang -0.008055   0.065345  -0.123    0.902</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Apply analytical bias correction</span></span></span>
<span class="r-in"><span><span class="va">mod_bc</span> <span class="op">&lt;-</span> <span class="fu"><a href="bias_corr.html">bias_corr</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_bc</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: trade ~ lang | year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x5680898b2c28&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Family: Binomial</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |      | Estimate | Std. Error | z value | Pr(&gt;|z|) |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |------|----------|------------|---------|----------|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> | lang |  -0.0341 |     0.2774 | -0.1230 |   0.9021 |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Significance codes: *** 99.9%; ** 99%; * 95%; . 90%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of observations: Full 500; Missing 0; Perfect classification 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 3 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute bias-corrected average partial effects</span></span></span>
<span class="r-in"><span><span class="va">mod_ape_bc</span> <span class="op">&lt;-</span> <span class="fu">apes</span><span class="op">(</span><span class="va">mod_bc</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mod_ape_bc</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Estimate Std. Error z value Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lang -0.008086   0.065345  -0.124    0.902</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mauricio Vargas Sepulveda.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

